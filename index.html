<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Safety Competence Test</title>

<style>
    body { font-family: Arial, sans-serif; background:#eef3f7; margin:0; }

    .container {
        width:90%; max-width:900px; margin:25px auto;
        background:white; padding:20px 24px;
        border-radius:10px; box-shadow:0 0 10px #ccc;
    }

    .start-btn, .submit-btn {
        background:#1a73e8; color:white;
        padding:10px 20px; border:none;
        border-radius:6px; cursor:pointer;
        font-size:15px; font-weight:600;
    }
    .ghost { background:#e8eeff; color:#1a73e8; border:1px solid #bcd0ff; }

    .question { margin:14px 0; padding:10px; background:#f8fbff; border-radius:6px; }
    .question p { font-weight:600; }
</style>
</head>

<body>

<!-- ================= START PAGE ================= -->
<div class="container" id="startPage">
    <h1>Safety Competence Assessment</h1>

    <p><b>Instructions:</b></p>
    <ul>
        <li>You have <b>100 minutes</b> to complete the test.</li>
        <li>Test will switch to <b>full-screen mode</b>.</li>
        <li>This demo contains <b>10 MCQs</b>.</li>
        <li>Each question carries <b>1 mark</b>.</li>
    </ul>

    <label><b>Enter Your Name:</b></label><br>
    <input id="username" style="padding:8px;width:60%;margin:8px 0;">

    <button class="start-btn" onclick="startTest()">Start Test</button>
</div>


<!-- ================= SECTION A ================= -->
<div class="container" id="sectionA" style="display:none;">
    <h1>Section A – General Safety</h1>

    <div class="question">
        <p>1. What is the first step in hazard identification?</p>
        <label><input type="radio" name="q1" value="Observe workplace" data-correct="Observe workplace"> Observe workplace</label><br>
        <label><input type="radio" name="q1" value="Ignore hazards"> Ignore hazards</label>
    </div>

    <div class="question">
        <p>2. PPE stands for?</p>
        <label><input type="radio" name="q2" value="Personal Protective Equipment" data-correct="Personal Protective Equipment"> Personal Protective Equipment</label><br>
        <label><input type="radio" name="q2" value="People Protection Exam"> People Protection Exam</label>
    </div>

    <div class="question">
        <p>3. Fire extinguisher type for electrical fire?</p>
        <label><input type="radio" name="q3" value="CO₂" data-correct="CO₂"> CO₂</label><br>
        <label><input type="radio" name="q3" value="Water"> Water</label>
    </div>

    <div class="question">
        <p>4. Safety signs in red indicate?</p>
        <label><input type="radio" name="q4" value="Prohibition" data-correct="Prohibition"> Prohibition</label><br>
        <label><input type="radio" name="q4" value="Mandatory"> Mandatory</label>
    </div>

    <div class="question">
        <p>5. Purpose of a risk assessment?</p>
        <label><input type="radio" name="q5" value="Identify hazards" data-correct="Identify hazards"> Identify hazards</label><br>
        <label><input type="radio" name="q5" value="Increase paperwork"> Increase paperwork</label>
    </div>

    <!-- Left aligned NEXT -->
    <div style="display:flex; gap:6px; margin-top:10px;">
        <button class="start-btn" onclick="goToSectionB()">Next →</button>
    </div>
</div>


<!-- ================= SECTION B ================= -->
<div class="container" id="sectionB" style="display:none;">
    <h1>Section B – Workplace Safety</h1>

    <div class="question">
        <p>6. Minimum safe distance from welding arc?</p>
        <label><input type="radio" name="q6" value="10 meters" data-correct="10 meters"> 10 meters</label><br>
        <label><input type="radio" name="q6" value="1 meter"> 1 meter</label>
    </div>

    <div class="question">
        <p>7. Best way to prevent slips?</p>
        <label><input type="radio" name="q7" value="Keep floor clean and dry" data-correct="Keep floor clean and dry"> Keep floor clean</label><br>
        <label><input type="radio" name="q7" value="Walk fast"> Walk fast</label>
    </div>

    <div class="question">
        <p>8. Lockout/Tagout is used for?</p>
        <label><input type="radio" name="q8" value="Isolate energy" data-correct="Isolate energy"> Isolate energy</label><br>
        <label><input type="radio" name="q8" value="Clean tools"> Clean tools</label>
    </div>

    <div class="question">
        <p>9. Unsafe condition example?</p>
        <label><input type="radio" name="q9" value="Exposed wires" data-correct="Exposed wires"> Exposed wires</label><br>
        <label><input type="radio" name="q9" value="Wearing PPE"> Wearing PPE</label>
    </div>

    <div class="question">
        <p>10. Safe ladder angle?</p>
        <label><input type="radio" name="q10" value="75°" data-correct="75°"> 75°</label><br>
        <label><input type="radio" name="q10" value="30°"> 30°</label>
    </div>

    <!-- Left aligned BACK + SUBMIT -->
    <div style="display:flex; gap:6px; margin-top:10px;">
        <button class="start-btn ghost" onclick="goBackToSectionA()">← Back</button>
        <button class="submit-btn" onclick="submitTest()">Submit</button>
    </div>
</div>


<!-- ================= THANK YOU PAGE ================= -->
<div class="container" id="resultPage" style="display:none;">
    <h1>Thank You</h1>
    <p>Your response has been recorded.</p>
    <p>You may close this tab.</p>
</div>


<!-- ================= LOGIC + SEND TO GOOGLE SHEETS ================= -->
<script>

// Your Google Web App URL
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycby2I9zGY1MrW3h1njOooyA3qIxsZpuig_bYj9NIo8m3d6_mz_getCXTWSZ4HdHHoU0J8A/exec";

// Queue to guarantee sending
let sendQueue = JSON.parse(localStorage.getItem("sendQueue") || "[]");

function queuePayload(data){
    sendQueue.push(data);
    localStorage.setItem("sendQueue", JSON.stringify(sendQueue));
    sendNext();
}

function sendNext(){
    if(sendQueue.length === 0) return;

    fetch(WEB_APP_URL, {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify(sendQueue[0])
    })
    .then(()=>{
        sendQueue.shift();
        localStorage.setItem("sendQueue", JSON.stringify(sendQueue));
        if(sendQueue.length > 0) sendNext();
    })
    .catch(()=> setTimeout(sendNext, 5000));
}

setInterval(sendNext, 10000);


// PAGE FLOW
function startTest() {
    if(document.documentElement.requestFullscreen){
        document.documentElement.requestFullscreen().catch(()=>{});
    }
    startPage.style.display="none";
    sectionA.style.display="block";
}

function goToSectionB(){
    sectionA.style.display="none";
    sectionB.style.display="block";
}

function goBackToSectionA(){
    sectionB.style.display="none";
    sectionA.style.display="block";
}


// SUBMIT LOGIC
function submitTest(){
    sectionA.style.display="none";
    sectionB.style.display="none";
    resultPage.style.display="block";

    let sectionA_score=0, sectionB_score=0, total=0;
    let answers=[], correctAnswers=[], status=[];

    for(let i=1;i<=10;i++){
        const sel=document.querySelector(`input[name="q${i}"]:checked`);
        const cor=document.querySelector(`input[name="q${i}"][data-correct]`);

        const selected = sel ? sel.value : "Not answered";
        const correct  = cor ? cor.value : "";

        answers.push(selected);
        correctAnswers.push(correct);

        if(selected === correct){
            status.push("Correct");
            total++;
            if(i<=5) sectionA_score++;
            else sectionB_score++;
        } else {
            status.push("Wrong");
        }
    }

    queuePayload({
        name:document.getElementById("username").value,
        sectionA:sectionA_score,
        sectionB:sectionB_score,
        totalScore:total,
        answers,
        correctAnswers,
        status,
        timestamp:new Date().toISOString()
    });
}

</script>
</body>
</html>
